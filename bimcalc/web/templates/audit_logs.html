{% extends "base.html" %}

{% block title %}System Audit Logs - BIMCalc{% endblock %}

{% block content %}
<div class="page-header">
    <h1>System Audit Logs</h1>
    <p>Track user actions and system events.</p>
</div>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>User</th>
                <th>Action</th>
                <th>Resource</th>
                <th>IP Address</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                <td>
                    {% if log.username %}
                    {{ log.username }}
                    {% else %}
                    <span class="text-muted">System</span>
                    {% endif %}
                </td>
                <td>
                    <span
                        class="badge {% if 'FAIL' in log.action %}badge-danger{% elif 'CREATE' in log.action %}badge-success{% elif 'UPDATE' in log.action %}badge-warning{% else %}badge-info{% endif %}">
                        {{ log.action }}
                    </span>
                </td>
                <td>
                    {% if log.resource_type %}
                    {{ log.resource_type }}
                    {% if log.resource_id %}: {{ log.resource_id }}{% endif %}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ log.ip_address or '-' }}</td>
                <td>
                    {% if log.details %}
                    <details>
                        <summary style="cursor: pointer; color: var(--accent-primary);">View Details</summary>
                        <pre
                            style="font-size: 0.75rem; background: var(--bg-tertiary); padding: 0.5rem; border-radius: 0.25rem; margin-top: 0.25rem;">{{ log.details | tojson(indent=2) }}</pre>
                    </details>
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if total_pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}">Previous</a>
        {% endif %}

        <span>Page {{ page }} of {{ total_pages }}</span>

        {% if page < total_pages %} <a href="?page={{ page + 1 }}">Next</a>
            {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}